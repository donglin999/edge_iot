#if _MSC_VER > 1000
#pragma once
#endif 

#include "VK70xNMC_DAQ2.h"
#include "dvr_header.h"
#include <Windows.h>
#include <stdio.h>


//-------------------------------------
void copy_string(char *p1, char *p2)
{
	while (*p2 != '\0')
	{
		*p1 = *p2;
		p1++;
		p2++;
	}
	*p1 = '\0';
}


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// common strings function
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


int  CommStr_RemoveInvaildCharForHex(char *tsrcstring, char *tresstr)
{
	size_t  tlen = strlen(tsrcstring);
	int  treslen = 0;
	char tempchar;
	for (size_t i = 0; i<tlen; i++)
	{
		tempchar = *tsrcstring++;
		if (((tempchar >= '0') && (tempchar <= '9')) || ((tempchar >= 'A') && (tempchar <= 'F')) || ((tempchar >= 'a') && (tempchar <= 'f')))
		{
			*tresstr++ = tempchar;
			treslen++;
		}
	}
	return treslen;
}


int  CommStr_RemoveInvaildCharForInteger(char *tsrcstring, char *tresstr)
{
	size_t  tlen = strlen(tsrcstring);
	int  treslen = 0;
	char tempchar;
	for (size_t i = 0; i<tlen; i++)
	{
		tempchar = *tsrcstring++;
		if ((tempchar >= '0') && (tempchar <= '9'))
		{
			*tresstr++ = tempchar;
			treslen++;
		}
	}
	return treslen;
}


int  CommStr_RemoveInvaildCharForDouble(char *tsrcstring, char *tresstr)
{
	size_t  tlen = strlen(tsrcstring);
	int  treslen = 0;
	char tempchar;
	for (size_t i = 0; i<tlen; i++)
	{
		tempchar = *tsrcstring++;
		if (((tempchar >= '0') && (tempchar <= '9')) || (tempchar <= '.') || (tempchar <= '-'))  //||(tempchar<='+')
		{
			*tresstr++ = tempchar;
			treslen++;
		}
	}
	// *tresstr++ = '\0';
	//treslen++;
	return treslen;
}


int  CommStr_GetParameterDoubleValueFromCongfigfile(char tkeychar, char *tsrcstring, double *value)
{
	size_t  tlen = strlen(tsrcstring);
	int  treslen = 0;
	int  stflag = 0;
	//double tempdl; 
	char tempchar;
	char *tresbuffer, *bufpi;
	//double temp;

	//==============================
	tresbuffer = (char *)malloc(sizeof (char)* (tlen));  // 50000
	bufpi = tresbuffer;
	memset(bufpi, '\0', tlen);
	for (size_t i = 0; i<tlen; i++)
	{
		tempchar = *tsrcstring++;
		if (stflag == 1)
		{
			if ((tempchar >= '0') && (tempchar <= '9'))  //||(tempchar<='+')
			{
				*bufpi++ = tempchar;
				treslen++;
			}
			else if ((tempchar == '.') || (tempchar == '-'))
			{
				*bufpi++ = tempchar;
				treslen++;
			}
		}
		else
		{
			if (tempchar == tkeychar)stflag = 1;
		}
	}
	///////////////////////////////////

	if ((stflag == 0) || (treslen == 0))
	{
		free(tresbuffer);
		return -1;// 格式错误
	}

	*bufpi = '\0';
	*value = atof(tresbuffer);   //
	////////////////////////////////////
	free(tresbuffer);
	return 0;
}



int  CommStr_GetParameterUnintegerValueFromCongfigfile(char tkeychar, char *tsrcstring, int *value) // 短整形
{
	size_t  tlen = strlen(tsrcstring);
	int  treslen = 0;
	int  stflag = 0;
	char tempchar;
	char *tresbuffer, *bufpi;
	//==============================
	tresbuffer = (char *)malloc(sizeof (char)* (tlen));  // 50000
	bufpi = tresbuffer;
	memset(bufpi, '\0', tlen);
	for (size_t i = 0; i<tlen; i++)
	{
		tempchar = *tsrcstring++;
		if (stflag == 1)
		{
			if ((tempchar >= '0') && (tempchar <= '9'))  //||(tempchar<='+')
			{
				*bufpi++ = tempchar;
				treslen++;
			}
		}
		else
		{
			if (tempchar == tkeychar)stflag = 1;
		}
	}
	/////////////////////////////////// 
	if ((stflag == 0) || (treslen == 0))
	{
		free(tresbuffer);
		return -1;// 格式错误
	}
	*bufpi = '\0';
	*value = atoi(tresbuffer);   //
	////////////////////////////////////
	free(tresbuffer);
	return 0;
}


int  CommStr_GetNewStringsFromCongfigfile(const char tkeychar, const char *tsrcstring, char *deststr)
{
	size_t  tlen = strlen(tsrcstring);
	int  treslen = 0;
	int  stflag = 0;
	char tempchar;
	for (size_t i = 0; i<tlen; i++)
	{
		tempchar = *tsrcstring++;
		//if (tempchar == '\0')return treslen;// 读到换行字符自动退出
		if (stflag == 1)
		{
			*deststr++ = tempchar;
			treslen++;
		}
		else
		{
			if (tempchar == tkeychar)
				stflag = 1;
		}
	}
	return treslen;
}

int  CommStr_GetNewStringsFromCongfigfile_RemoveSpecialCharacters(const char tkeychar, const char *tsrcstring, char *deststr)
{
	size_t  tlen = strlen(tsrcstring);
	int  treslen = 0;
	int  stflag = 0;
	char tempchar;
	for (size_t i = 0; i<tlen; i++)
	{
		tempchar = *tsrcstring++;
		//if (tempchar == '\0')return treslen;// 读到换行字符自动退出
		if (stflag == 1)
		{
			if ((tempchar != ' ') && (tempchar != '\"'))
			{
				*deststr++ = tempchar;
				treslen++;
			}
		}
		else
		{
			if (tempchar == tkeychar)
				stflag = 1;
		}
	}
	return treslen;
}

int CommStr_GetNewStringsWithBlankFromCongfigfile_RemoveSpecialCharacters(const char tkeychar, const char *tsrcstring, char *deststr)
{
	size_t  tlen = strlen(tsrcstring);
	int  treslen = 0;
	int  stflag = 0;
	char tempchar;
	for (size_t i = 0; i<tlen; i++)
	{
		tempchar = *tsrcstring++;
		//if (tempchar == '\0')return treslen;// 读到换行字符自动退出
		if (stflag == 1)
		{
			if ((tempchar != '\"') && (tempchar != '\n'))
			{
				*deststr++ = tempchar;
				treslen++;
			}
		}
		else
		{
			if (tempchar == tkeychar)
				stflag = 1;
		}
	}
	return treslen;
}